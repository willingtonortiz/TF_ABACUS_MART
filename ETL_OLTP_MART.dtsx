<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="10/11/2021 3:13:16 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="DESKTOP-6TFJBIU"
  DTS:CreatorName="DESKTOP-6TFJBIU\willi"
  DTS:DTSID="{52C3D914-18C3-415C-BA1D-66734673C971}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.2000.170"
  DTS:LocaleID="3082"
  DTS:ObjectName="Package1"
  DTS:PackageType="5"
  DTS:VersionBuild="7"
  DTS:VersionGUID="{881BE3A7-56D3-4BE0-B510-948FEDF79BAE}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:Variables />
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Eliminar Registros"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Tarea Ejecutar SQL"
      DTS:DTSID="{B55C2692-446D-4923-9EB7-437F65EACE0E}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Eliminar Registros"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2019; © 2019 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{BFFDCC3F-154B-4199-B479-27A958180F05}"
          SQLTask:SqlStatementSource="TRUNCATE TABLE Dim_Clientes&#xA;TRUNCATE TABLE Dim_Puertos&#xA;TRUNCATE TABLE Dim_Transportes&#xA;TRUNCATE TABLE Dim_Mercancias&#xA;TRUNCATE TABLE Dim_Estado_Ordenes&#xA;TRUNCATE TABLE Dim_Tipo_Transporte&#xA;TRUNCATE TABLE Dim_Rango_CIF&#xA;TRUNCATE TABLE Dim_Fechas&#xA;TRUNCATE TABLE FACT_Orden" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Poblar Dim_Fechas"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Tarea Ejecutar SQL"
      DTS:DTSID="{2B654310-6CC6-48A7-B020-DDD8171D7A09}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Poblar Dim_Fechas"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2019; © 2019 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{BFFDCC3F-154B-4199-B479-27A958180F05}"
          SQLTask:SqlStatementSource="USE [BD_ABACUS]&#xA;&#xA;DECLARE @FechaDesde date,@FechaHasta date&#xA;&#xA;DECLARE @Sk_Fecha int,&#xA;        @FechaEvaluada date,@Anio int,&#xA;&#x9;&#x9;@Semestre nvarchar(30),@Trimestre nvarchar(30),@Mes nvarchar(30),@DiaSemana nvarchar(30)&#xA;DECLARE @NumSemestreAnio smallint,@NumTrimestreAnio smallint,@NumMesAnio smallint,&#xA;        @NumDiaSemana smallint,@NumDiaMes smallint&#xA;&#xA;&#xA;&#xA;--Set inicial por si no coincide con los del servidor&#xA;SET DATEFORMAT dmy&#xA;SET DATEFIRST 1&#xA;&#xA;BEGIN TRANSACTION&#xA;    --Borrar datos de la tabla Dim_Fechas&#xA;    TRUNCATE TABLE  Dim_Fechas&#xA;   &#xA;    --Rango de fechas a generar: del 01/01/2016 al 31/12/2013&#xA;    SELECT @FechaDesde = CAST('20190101' AS date)&#xA;&#x9;SELECT @FechaHasta = CAST('20201231' AS date)&#xA;&#xA;&#x9;--Carga la variable @FechaEvaluada con el valor inicial de la @FechaDesde&#xA;&#x9;SET @FechaEvaluada = @FechaDesde&#xA;    &#xA;&#x9;--Esta línea permite agregar 2 años mas al año actual, se deja como ejemplo&#xA;&#x9;--SELECT @FechaHasta = CAST(CAST(YEAR(GETDATE())+2 AS CHAR(4)) + '1231' AS smalldatetime)&#xA;&#xA;    --Inicio de BUCLE para insertar registros en la tabla Dim_Fechas&#xA;    WHILE (@FechaEvaluada &lt;= @FechaHasta) --Mientras @FechaEvaluada sea menor o igual a la @FechaHasta&#xA;&#x9;   BEGIN&#xA;            --Obtiene el valor para el campo SK_FECHA en formato número YYYYMMDD de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @Sk_Fecha = YEAR(@FechaEvaluada)*10000 + MONTH(@FechaEvaluada)*100 + DATEPART(dd, @FechaEvaluada)&#xA;            --Obtiene el año de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @Anio = DATEPART(yy, @FechaEvaluada)&#xA;&#x9;&#x9;&#x9;--Obtiene la descripción del semestre de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @Semestre = CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;     WHEN Month(@FechaEvaluada) &lt;= 6 THEN 'Semestre 1' &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ELSE 'Semestre 2'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   END&#xA;             --Obtiene la descripción del trimestre de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @Trimestre = CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;     WHEN Month(@FechaEvaluada) &lt;= 3 THEN 'Trimestre 1' &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHEN Month(@FechaEvaluada) &lt;= 6 THEN 'Trimestre 2'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHEN Month(@FechaEvaluada) &lt;= 9 THEN 'Trimestre 3'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ELSE 'Trimestre 4'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   END&#xA;&#x9;&#x9;&#x9; --Obtiene la descripción del mes de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @Mes = CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 1 THEN 'Enero' &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 2 THEN 'Febrero'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 3 THEN 'Marzo'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 4 THEN 'Abril'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 5 THEN 'Mayo' &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 6 THEN 'Junio'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 7 THEN 'Julio'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 8 THEN 'Agosto'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 9 THEN 'Setiembre' &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 10 THEN 'Octubre'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 11 THEN 'Noviembre'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN Month(@FechaEvaluada) = 12 THEN 'Diciembre'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  END&#xA;&#xA;&#x9;&#x9;&#x9; --Obtiene la descripción del día de la semana de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @DiaSemana = CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 1 THEN 'Lunes'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 2 THEN 'Martes'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 3 THEN 'Miércoles'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 4 THEN 'Jueves'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 5 THEN 'Viernes'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 6 THEN 'Sábado'&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;WHEN DATEPART(dw, @FechaEvaluada) = 7 THEN 'Domingo' &#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;END&#xA; &#xA;&#x9;&#x9;&#x9;--Obtiene la posición del semestre en el año de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @NumSemestreAnio = CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHEN Month(@FechaEvaluada) &lt;= 6 THEN 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ELSE 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   END&#xA;&#xA;&#x9;&#x9;&#x9;--Obtiene la posición del trimestre en el año de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @NumTrimestreAnio = CASE&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHEN Month(@FechaEvaluada) &lt;= 3 THEN 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHEN Month(@FechaEvaluada) &lt;= 6 THEN 2&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; WHEN Month(@FechaEvaluada) &lt;= 9 THEN 3&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; ELSE 4&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;   END&#xA;&#xA;&#x9;&#x9;&#x9;--Obtiene la posición del mes en el año de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @NumMesAnio = Month(@FechaEvaluada)&#xA;&#xA;&#x9;&#x9;&#x9;--Obtiene la posición del día de la semana de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @NumDiaSemana = DATEPART(dw, @FechaEvaluada)&#xA;&#xA;&#x9;&#x9;&#x9;--Obtiene la posición del día del mes de la @FechaEvaluada&#xA;&#x9;&#x9;&#x9;SELECT @NumDiaMes = DAY(@FechaEvaluada)&#xA;&#xA;&#x9;&#x9;&#x9;--Inserta el registro con los valores extraídos de la @FechaEvaluada en la tabla Dim_Fechas&#xA;&#x9;&#xA;&#x9;&#x9;&#x9;INSERT INTO Dim_Fechas&#xA;&#x9;&#x9;&#x9;(&#x9;Sk_Fecha,Fecha,Anio,Semestre,Trimestre,Mes,DiaSemana,&#xA;&#x9;&#x9;&#x9;    NumSemestreAnio,NumTrimestreAnio,NumMesAnio,NumDiaSemana,NumDiaMes )&#xA;&#x9;&#x9;&#x9;VALUES&#xA;&#x9;&#x9;&#x9;(   @Sk_Fecha,@FechaEvaluada,@Anio,@Semestre,@Trimestre,@Mes,@DiaSemana,&#xA;&#x9;&#x9;&#x9;    @NumSemestreAnio,@NumTrimestreAnio,@NumMesAnio,@NumDiaSemana,@NumDiaMes )&#xA;&#x9;&#x9;&#x9;&#x9;&#xA;   &#xA;&#x9;&#x9;&#x9;--Incremento el valor de la @FechaEvaluada en un día&#xA;&#x9;&#x9;&#x9;SELECT @FechaEvaluada = DATEADD(DAY, 1, @FechaEvaluada)&#xA;    END&#xA;    COMMIT TRANSACTION" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Restricción]"
      DTS:CreationName=""
      DTS:DTSID="{4F90E6F9-7585-4660-9846-D43763EEF5EC}"
      DTS:From="Package\Eliminar Registros"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Restricción"
      DTS:To="Package\Poblar Dim_Fechas" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Esta sección CDATA contiene la información de diseño del paquete. Esta sección incluye información como, por ejemplo, las coordenadas (x,y), el ancho y el alto.-->
<!--Si edita manualmente esta sección y comete un error, puede eliminarlo. -->
<!--El paquete podrá cargarse normalmente, pero se perderá la información de diseño anterior y el diseñador reorganizará los elementos automáticamente en la superficie de diseño.-->
<Objects
  Version="8">
  <!--Cada uno de los nodos siguientes contiene propiedades que no afectan al comportamiento en tiempo de ejecución.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph">
        <AnnotationLayout
          Text="ETL_OLTP_MART"
          ParentId="Package"
          FontInfo="{assembly:Null}"
          Size="116,60"
          Id="1df7cc9d-f5cc-4c43-91bd-adb2684cae5d"
          TopLeft="20,23" />
        <NodeLayout
          Size="163,42"
          Id="Package\Eliminar Registros"
          TopLeft="183.846153846154,35.3846153846154" />
        <NodeLayout
          Size="169,42"
          Id="Package\Poblar Dim_Fechas"
          TopLeft="57.6923076923077,151.538461538462" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Restricción]"
          TopLeft="265.346153846154,77.3846153846154">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-123.153846153846,74.1538461538461"
              Start="0,0"
              End="-123.153846153846,66.6538461538461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,33.0769230769231" />
                  <mssgle:CubicBezierSegment
                    Point1="0,33.0769230769231"
                    Point2="0,37.0769230769231"
                    Point3="-4,37.0769230769231" />
                  <mssgle:LineSegment
                    End="-119.153846153846,37.0769230769231" />
                  <mssgle:CubicBezierSegment
                    Point1="-119.153846153846,37.0769230769231"
                    Point2="-123.153846153846,37.0769230769231"
                    Point3="-123.153846153846,41.0769230769231" />
                  <mssgle:LineSegment
                    End="-123.153846153846,66.6538461538461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>